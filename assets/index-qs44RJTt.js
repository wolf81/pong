(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();function P(a){const t=a.split("/").pop()?.split("\\").pop()?.split(".")||[];return t.length<=1?t[0]||"":(t.pop(),t.join("."))}const ht=[".png",".jpg"],ct=[".wav",".mp3",".ogg"],lt=[".ttf"];class f{_imageRegistry=new Map;_audioRegistry=new Map;getImage(t){return this._imageRegistry.get(t)}getAudio(t){return this._audioRegistry.get(t)}async preload(){try{const t=await fetch("assets/manifest.json");if(!t.ok)throw new Error(`Failed to load manifest: ${t.statusText}`);const e=await t.json();console.log("Manifest loaded:",e);for(const s of e.assets){const i=`assets/${s}`;if(console.log(`Loading asset: ${i}`),ht.some(n=>i.endsWith(n))){const n=new Image;n.src=i,await n.decode(),this._imageRegistry.set(P(s),n);continue}if(ct.some(n=>i.endsWith(n))){const n=new Audio(i);n.load(),this._audioRegistry.set(P(s),n);continue}if(lt.some(n=>i.endsWith(n))){const n=P(s),o=new FontFace(n,`url(${i})`);await o.load(),document.fonts.add(o);continue}}}catch(t){console.error("Error loading manifest:",t)}}}class B{_keys=new Set;_keyTimes=new Map;_releasedKeys=new Set;_repeatDelay=300;_repeatInterval=100;_mouseX=-1;_mouseY=-1;_isMouseDown=!1;_isMouseClicked=!1;constructor(t){window.addEventListener("keydown",e=>{e.preventDefault();const s=e.key;if(!this._keys.has(s)){this._keys.add(s);const i=performance.now();this._keyTimes.set(s,{pressedAt:i,lastRepeat:0})}}),window.addEventListener("keyup",e=>{e.preventDefault();const s=e.key;this._keys.delete(s),this._keyTimes.delete(s),this._releasedKeys.add(s)}),window.addEventListener("mousedown",e=>{this._isMouseDown=!0}),window.addEventListener("mouseup",e=>{this._isMouseDown=!1,this._isMouseClicked=!0}),window.addEventListener("mousemove",e=>{const s=t.getBoundingClientRect();this._mouseX=e.clientX-s.left,this._mouseY=e.clientY-s.top})}update(){this._releasedKeys.clear(),this._isMouseClicked=!1}isKeyDown(t){return this._keys.has(t)}wasKeyReleased(t){return this._releasedKeys.has(t)}getMousePosition(){return{x:this._mouseX,y:this._mouseY}}get isMouseDown(){return this._isMouseDown}get isMouseClicked(){return this._isMouseClicked}shouldFire(t){if(!this._keys.has(t))return!1;const e=performance.now(),s=this._keyTimes.get(t);if(!s)return!1;const i=e-s.pressedAt;if(s.lastRepeat===0)return s.lastRepeat=e,!0;const n=e-s.lastRepeat;return i>=this._repeatDelay&&n>=this._repeatInterval?(s.lastRepeat=e,!0):!1}}class T{async init(){}deinit(){}}class M{constructor(t,e){this.width=t,this.height=e}_scenes=[{async init(){},deinit(){},update(){},draw(){}}];get current(){return this._scenes[this._scenes.length-1]}async switch(t){await t.init(),this._scenes=[t]}async push(t){await t.init(),this._scenes.push(t)}pop(){return this._scenes.length>1?(this._scenes.pop(),!0):!1}update(t){this._scenes[this._scenes.length-1].update(t)}draw(t){for(let e of this._scenes)e.draw(t)}}class u{static services=new Map;static register(t,e){this.services.set(t,e)}static resolve(t){if(!this.services.has(t))throw new Error(`No service registered of type: ${t.name}.`);return this.services.get(t)}}class L{static showFps=!1;static showDraws=!1}class R{static generate(t,e,s){const i=document.createElement("canvas");i.width=t,i.height=e;const n=i.getContext("2d");return s(n),i}static stretch(t,e,s,i=10){const n=t.width,o=t.height,r=document.createElement("canvas");r.width=e,r.height=s;const w=r.getContext("2d"),x=[0,i,e-i,e],z=[0,i,s-i,s],k=[0,i,n-i,n],d=[0,i,o-i,o];for(let h=0;h<3;h++)for(let b=0;b<3;b++){const tt=k[b],et=d[h],st=k[b+1]-k[b],it=d[h+1]-d[h],at=x[b],nt=z[h],ot=x[b+1]-x[b],rt=z[h+1]-z[h];w.drawImage(t,tt,et,st,it,at,nt,ot,rt)}return r}}class E{w;h;constructor(t,e){this.w=t,this.h=e}static get zero(){return new E(0,0)}}class c{x;y;constructor(t,e){this.x=t,this.y=e}static get zero(){return new c(0,0)}static fromAngle(t){return new c(Math.cos(t),Math.sin(t))}add(t){return new c(this.x+t.x,this.y+t.y)}sub(t){return new c(this.x-t.x,this.y-t.y)}mul(t){return new c(this.x*t,this.y*t)}lerp(t,e){const s=this.x+(t.x-this.x)*e,i=this.y+(t.y-this.y)*e;return new c(s,i)}clone(){return new c(this.x,this.y)}}function q(a,t){const e=a.xMid,s=a.yMid,i=a.radius,n=Math.max(t.x1,Math.min(e,t.x2)),o=Math.max(t.y1,Math.min(s,t.y2)),r=e-n,w=s-o;return r*r+w*w<i*i}class j{_pos;get pos(){return this._pos}get x(){return this._pos.x}get y(){return this._pos.y}set pos(t){this._pos=t}constructor(t){this._pos=t}}class I extends j{_size;get size(){return this._size}get x1(){return this._pos.x}get xMid(){return this._pos.x+this._size.w/2}get x2(){return this._pos.x+this._size.w}get y1(){return this._pos.y}get yMid(){return this._pos.y+this._size.h/2}get y2(){return this._pos.y+this._size.h}get w(){return this.size.w}get h(){return this.size.h}constructor(t,e){super(t),this._size=e}static get zero(){return new I(c.zero,E.zero)}intersects(t){if(t instanceof J)return q(t,this);throw new Error(`Intersect check not implemented for ${t}.`)}containsPoint(t){return t.x>=this.x1&&t.x<=this.x2&&t.y>=this.y1&&t.y<=this.y2}}class J extends j{_radius;get radius(){return this._radius}get xMin(){return this._pos.x}get xMax(){return this._pos.x+this._radius*2}get xMid(){return this._pos.x+this._radius}get yMin(){return this._pos.y}get yMid(){return this._pos.y+this._radius}get yMax(){return this._pos.y+this._radius*2}constructor(t,e){super(t),this._radius=e}intersects(t){if(t instanceof I)return q(this,t);throw new Error(`Intersect check not implemented for ${t}.`)}containsPoint(t){const e=this.xMid-t.x,s=this.yMid-t.y;return e*e+s*s<=Math.pow(this.radius,2)}}class C{children;minSize;stretch;spacing;expSize=null;frame=null;constructor(t,e={w:0,h:0},s="all",i){this.children=t,this.minSize=e,this.stretch=s,this.spacing=i}reshape(t,e,s,i){this.expand(),this.layout({x:t,y:e,w:s,h:i})}*widgets(){for(const t of this.children)yield*t.widgets()}expand(){for(const t of this.children)t.expand();this.expandChildren()}layout(t){this.layoutChildren(t);for(const e of this.children)e.frame&&e.layout(e.frame)}static spread(t,e){const s=e.map(([d])=>d),i=e.map(([,d])=>d),n=s.reduce((d,h)=>d+h,0),o=Math.max(0,t-n),r=i.reduce((d,h)=>d+h,0),w=r>0?Math.floor(o/r):0,x=i.map(d=>d*w),z=x.reduce((d,h)=>d+h,0),k=o-z;if(k!==0){const d=i.map((h,b)=>[h,b]).filter(([h])=>h>0).map(([,h])=>h).pop();d!==void 0&&(x[d]+=k)}return s.map((d,h)=>d+x[h])}}class dt extends C{widget;constructor(t,e={w:0,h:0},s="all"){super([],e,s,0),this.widget=t}*widgets(){yield this.widget}expandChildren(){this.expSize=this.minSize}layoutChildren(t){this.widget.setFrame(t)}}class ut extends C{margin;constructor(t,e={w:0,h:0},s="all",i={l:0,t:0,r:0,b:0}){super(t,e,s,0),this.margin=i}expandChildren(){let t=this.margin.l+this.margin.r,e=this.margin.t+this.margin.b;for(const s of this.children)s.expSize&&(t=Math.max(t,s.expSize.w),e=Math.max(e,s.expSize.h));this.expSize={w:t,h:e}}layoutChildren(t){const{l:e,t:s,r:i,b:n}=this.margin,o=t.x+e,r=t.y+s,w=t.w-e-i,x=t.h-s-n;this.frame={x:o,y:r,w,h:x};for(const z of this.children)z.frame={x:o,y:r,w,h:x}}}class pt extends C{expandChildren(){let t=0,e=0;for(const s of this.children)s.expSize&&(t=Math.max(t,s.expSize.w),e+=s.expSize.h);e+=Math.max(0,this.children.length-1)*this.spacing,this.expSize={w:t,h:e}}layoutChildren(t){const e=Math.max(0,this.children.length-1)*this.spacing,s=C.spread(t.h-e,this.children.map(n=>[n.expSize?.h??0,n.stretch==="vertical"||n.stretch==="all"?1:0]));let i=t.y;for(let n=0;n<this.children.length;++n){const o=this.children[n],r=s[n],w=o.stretch==="horizontal"||o.stretch==="all"?t.w:o.expSize?.w??0;o.frame={x:t.x,y:i,w,h:r},i+=r+this.spacing}}}class _t extends C{expandChildren(){let t=0,e=0;for(const s of this.children)s.expSize&&(t+=s.expSize.w,e=Math.max(e,s.expSize.h));t+=Math.max(0,this.children.length-1)*this.spacing,this.expSize={w:t,h:e}}layoutChildren(t){const e=Math.max(0,this.children.length-1)*this.spacing,s=C.spread(t.w-e,this.children.map(n=>[n.expSize?.w??0,n.stretch==="horizontal"||n.stretch==="all"?1:0]));let i=t.x;for(let n=0;n<this.children.length;++n){const o=this.children[n],r=s[n],w=o.stretch==="vertical"||o.stretch==="all"?t.h:o.expSize?.h??0;o.frame={x:i,y:t.y,w:r,h:w},i+=r+this.spacing}}}class p{static border(t,e={}){return new ut(Array.isArray(t)?t:[t],e.minSize??{w:0,h:0},e.stretch??"all",e.margin??{t:0,b:0,l:0,r:0})}static hstack(t,e={}){return new _t(Array.isArray(t)?t:[t],{w:0,h:0},e.stretch??"horizontal",e.spacing??0)}static vstack(t,e={}){return new pt(Array.isArray(t)?t:[t],{w:0,h:0},e.stretch??"vertical",e.spacing??0)}static elem(t,e={}){return new dt(t,e.minSize??{w:0,h:0},e.stretch??"none")}static size(t,e){return{w:t,h:e}}static margin(t,e,s,i){return e=e??t,s=s??t,i=i??e,{l:t,t:e,r:s,b:i}}}function mt(a){return u.resolve(f).getImage(a)}class U{_state=0;_frame=I.zero;get state(){return this._state}setState(t){this._state=t}get frame(){return this._frame}setFrame(t){this._frame=new I(new c(t.x,t.y),new E(t.w,t.h))}update(t){}}class V extends U{_ox=0;_oy=0;_font;_text;_textColor;_fontSize;_backgroundName;_background;constructor(t,e){super(),this._text=t,this._textColor=e?.textColor??"#eeeeee";const s=e?.font??"Jumpman";this._fontSize=e?.size??24,this._font=`${this._fontSize}px ${s}`,this._backgroundName=e?.background}setFrame(t){if(super.setFrame(t),this._ox=t.x+Math.floor(t.w/2),this._oy=t.y+Math.floor(t.h/2),this._backgroundName){let e=mt(this._backgroundName);this._background=R.stretch(e,t.w,t.h)}}draw(t){this._background&&t.drawImage(this._background,this.frame.x,this.frame.y),t.drawText(this._text,this._ox,this._oy,{font:this._font,align:"center",color:this._textColor})}}class wt extends U{_background;_imageName;constructor(t){super(),this._imageName=t}draw(t){t.drawImage(this._background,this._frame.x,this._frame.y)}setFrame(t){super.setFrame(t);const s=u.resolve(f).getImage(this._imageName);this._background=R.stretch(s,t.w,t.h)}}class ft extends V{_onClick;_stateBackgrounds=new Map;constructor(t,e){super(t,e),this._onClick=e?.onClick?e.onClick:()=>{}}setFrame(t){super.setFrame(t);const e=u.resolve(f),s=new Map([[0,"button_square_depth_flat"],[1,"button_square_depth_gloss"],[2,"button_square_gloss"],[3,"button_square_depth_flat"]]);for(let[i,n]of s){let o=e.getImage(n);o=R.stretch(o,t.w,t.h),this._stateBackgrounds.set(i,o)}this._background=this._stateBackgrounds.get(0)}setState(t){super.setState(t),this._background=this._stateBackgrounds.get(this.state)}update(t){const e=this._frame.containsPoint(l.mouse.pos),s=e&&l.mouse.buttonState==="down",i=this.state===2&&l.mouse.buttonState==="up";if(e||this.setState(0),s&&!i){const n=l.mouse.buttonState==="down"?2:1;this.setState(n)}i&&(this._onClick(),this.setState(0))}}class gt extends U{draw(t){}}class l{static panel(t="button_square_border"){return p.elem(new wt(t),{minSize:{w:0,h:0},stretch:"all"})}static label(t,e){return p.elem(new V(t,e),{minSize:{w:0,h:e?.size??48},stretch:"horizontal"})}static button(t,e){return p.elem(new ft(t,e),{minSize:{w:192,h:64},stretch:"horizontal"})}static flexSpace(t){return p.elem(new gt,{stretch:t})}static _mouse={pos:c.zero,buttonState:"none"};static get mouse(){return this._mouse}static init(t){window.addEventListener("mousedown",e=>{this._mouse.buttonState="down"}),window.addEventListener("mouseup",e=>{this._mouse.buttonState="up"}),window.addEventListener("mousemove",e=>{const s=t.getBoundingClientRect();this._mouse.pos.x=e.clientX-s.left,this._mouse.pos.y=e.clientY-s.top})}static update(){this._mouse.buttonState==="up"&&(this._mouse.buttonState="none")}}class yt{constructor(t){this.compare=t}data=[];push(t){this.data.push(t),this.bubbleUp()}pop(){if(this.size()===0)return;const t=this.data[0],e=this.data.pop();return this.size()>0&&(this.data[0]=e,this.bubbleDown()),t}peek(){return this.data[0]}size(){return this.data.length}bubbleUp(){let t=this.data.length-1;for(;t>0;){const e=t-1>>1;if(this.compare(this.data[t],this.data[e])>=0)break;[this.data[t],this.data[e]]=[this.data[e],this.data[t]],t=e}}bubbleDown(){let t=0;const e=this.data.length;for(;;){const s=2*t+1,i=2*t+2;let n=t;if(s<e&&this.compare(this.data[s],this.data[n])<0&&(n=s),i<e&&this.compare(this.data[i],this.data[n])<0&&(n=i),n===t)break;[this.data[t],this.data[n]]=[this.data[n],this.data[t]],t=n}}}class v{_time=0;_heap;static _default=new v;constructor(){this._heap=new yt((t,e)=>t.scheduledAt-e.scheduledAt)}update(t){for(this._time+=t;;){const e=this._heap.peek();if(!e||e.scheduledAt>this._time)break;this._heap.pop()?.action()}}static update(t){this._default.update(t)}after(t,e){this._heap.push({scheduledAt:this._time+t,action:e})}static after(t,e){this._default.after(t,e)}every(t,e,s,i){const n=this._time+t,o=this._time+e;for(let r=n;r<o;r+=t)this._heap.push({scheduledAt:r,action:s});i&&this._heap.push({scheduledAt:o,action:i})}static every(t,e,s,i){this._default.every(t,e,s,i)}removeAllTimers(){for(;this._heap.size()>0;)this._heap.pop()}static removeAllTimers(){this._default.removeAllTimers()}}const y=1080,m=720;class ${static _alpha=0;static _accumulator=0;static _fps=0;static _lastTime=performance.now();static timeStep=1/60;static get lastTime(){return this._lastTime}static get fps(){return Math.floor(this._fps)}static get alpha(){return this._alpha}static update(t,e){const s=(t-this._lastTime)/1e3;for(this._fps=1/s,this._lastTime=t,this._accumulator+=s;this._accumulator>=this.timeStep;)e(this.timeStep),this._accumulator-=this.timeStep;this._alpha=this._accumulator/this.timeStep}}const xt=60;class bt{_prevPos;get prevPos(){return this._prevPos}sprite;pos=c.zero;size;isVisible=!0;constructor(t,e){this.sprite=t,this.pos=e??c.zero,this._prevPos=this.pos.clone(),this.size=new E(t.width,t.height)}update(t){this._prevPos=this.pos.clone()}draw(t){if(!this.isVisible)return;const e=this.prevPos.lerp(this.pos,$.alpha);t.drawImage(this.sprite,Math.floor(e.x),Math.floor(e.y))}}class Q extends bt{dir=c.zero;speed=8;update(t){super.update(t);const e=this.dir.mul(this.speed*xt*t);this.pos=this.pos.add(e),this.shape.pos=this.pos}collidesWith(t){return this.shape.intersects(t.shape)}}class K extends Q{_shape;get shape(){return this._shape}player;score=0;constructor(t,e,s){super(t,e),this.player=s,this._shape=new I(this.pos,this.size)}}class St extends Q{_shape;alpha=1;get shape(){return this._shape}constructor(t,e){super(t,e);const s=this.sprite.width/2;this._shape=new J(this.pos,s)}increaseSpeed(){this.speed=Math.min(this.speed+1,20)}draw(t){super.draw(t)}}var _=(a=>(a[a.One=0]="One",a[a.Two=1]="Two",a))(_||{});const S={None:c.zero,Up:new c(0,-1),Down:new c(0,1)};class g{static playSound(t){const s=u.resolve(f).getAudio(t);s.currentTime=0,s.play()}static playRandomImpactSound(t){u.resolve(f);const e=t<12?"heavy":t<16?"medium":"light";let s=[];switch(e){case"light":s=["impactWood_light_000","impactWood_light_001","impactWood_light_002","impactWood_light_003","impactWood_light_004"];break;case"medium":s=["impactWood_medium_000","impactWood_medium_001","impactWood_medium_002","impactWood_medium_003","impactWood_medium_004"];break;case"heavy":s=["impactWood_heavy_000","impactWood_heavy_001","impactWood_heavy_002","impactWood_heavy_003","impactWood_heavy_004"];break}const i=Math.floor(Math.random()*s.length);this.playSound(s[i])}}function Mt(){g.playSound("click5");const a=u.resolve(M);a.pop(),a.push(new X)}class zt extends T{_layout=p.border([l.panel(),p.border([p.vstack([l.label("Instructions",{size:40,textColor:"#ee2747"}),l.label("You control the left paddle.",{size:26,textColor:"#ee2747"}),l.label("Press <W> to move up, <S> to move down.",{size:26,textColor:"#ee2747"}),l.label("You score a point by moving the ball in opponent goal.",{size:26,textColor:"#ee2747"}),l.label("The first player that scores 5 points wins the game.",{size:26,textColor:"#ee2747"}),l.button("Menu",{size:32,onClick:()=>Mt()})],{spacing:20})],{margin:p.margin(16)})]);constructor(){super();const t=760,e=40+4*26+64+5*20+32,s=(y-t)/2,i=(m-e)/2;this._layout.reshape(s,i,t,e)}update(t){for(let e of this._layout.widgets())e.update(t)}draw(t){for(let e of this._layout.widgets())e.draw(t)}}function vt(){g.playSound("click5");const a=u.resolve(M);a.pop(),a.current.start()}function kt(){g.playSound("click5");const a=u.resolve(M);a.pop(),a.push(new zt)}class X extends T{_layout=p.border([l.panel(),p.border([p.vstack([l.label("Pong!",{size:40,textColor:"#ee2747"}),l.button("Play",{size:32,onClick:()=>vt()}),l.button("Instructions",{size:32,onClick:()=>kt()})],{spacing:20})],{margin:p.margin(16)})]);constructor(){super();const t=300,e=40+64*2+20*2+32,s=(y-t)/2,i=(m-e)/2;this._layout.reshape(s,i,t,e)}update(t){for(let e of this._layout.widgets())e.update(t)}draw(t){for(let e of this._layout.widgets())e.draw(t)}}function Lt(){g.playSound("click5");const a=u.resolve(M);a.pop(),a.push(new X)}function It(a){return p.border([l.panel(),p.border([p.vstack([l.label("Game Over",{size:26,textColor:"#ee2747"}),l.label(a===_.One?"You Win!":"You Lose!",{size:40,textColor:"#ee2747"}),l.button("Menu",{size:32,onClick:()=>Lt()})],{spacing:20})],{margin:p.margin(16)})])}class Ct extends T{_layout=p.border([]);_winner;constructor(t){super(),this._winner=t,this._layout=It(t);const e=300,s=130+20*2+32,i=(y-e)/2,n=(m-s)/2;this._layout.reshape(i,n,e,s)}update(t){for(let e of this._layout.widgets())e.update(t)}draw(t){for(let e of this._layout.widgets())e.draw(t)}async init(){switch(this._winner){case _.One:g.playSound("you_win");break;case _.Two:g.playSound("you_lose");break}}}const G=10,W=5,At=1.6,H=5;function Tt(){const t=u.resolve(f).getImage("texture_08");return R.generate(y,m,e=>{for(let s=0;s<e.canvas.width;s+=t.width)for(let i=0;i<e.canvas.height;i+=t.height)e.drawImage(t,s,i)})}function N(a){const t=u.resolve(f);switch(a){case _.One:{const e=t.getImage("paddleBlu"),s=new c(G,(m-e.height)/2);return new K(e,s,_.One)}case _.Two:{const e=t.getImage("paddleRed"),s=new c(y-e.width-G,(m-e.height)/2);return new K(e,s,_.Two)}}}function Rt(a,t,e){return Math.max(Math.min(a,e),t)}function F(){const t=u.resolve(f).getImage("ballGrey"),e=new c((y-t.width)/2,(m-t.height)/2),s=new St(t,e);let i=(Math.random()-.5)*Math.PI/1.5;return i+=Math.random()>.5?0:Math.PI,s.dir=c.fromAngle(i),s}function Et(a){u.resolve(M).push(new Ct(a))}function Dt(a,t,e){const s=u.resolve(B);switch(a.dir=S.None,a.player){case _.One:s.isKeyDown("w")&&(a.dir=S.Up),s.isKeyDown("s")&&(a.dir=S.Down);break;case _.Two:if(e===3&&(a.dir=S.None,a.shape.yMid<m/2-W&&(a.dir=S.Down),a.shape.yMid>m/2+W&&(a.dir=S.Up)),e===2&&t.dir.x>0){const i=a.shape.yMid-t.shape.yMid;Math.abs(i)>W&&(a.dir=i>0?S.Up:S.Down)}break}}class Nt extends T{_state=0;_background;_player1=N(_.One);_player2=N(_.Two);_ball=F();constructor(){super(),this._background=Tt()}async init(){const e=u.resolve(f).getImage("texture_08");this._background=R.generate(y,m,s=>{for(let i=0;i<s.canvas.width;i+=e.width)for(let n=0;n<s.canvas.height;n+=e.height)s.drawImage(e,i,n)})}deinit(){v.removeAllTimers()}update(t){if(this._state===0)return;let e=[this._player1,this._player2];for(let s of e)Dt(s,this._ball,this._state),s.update(t),s.pos.y=Rt(s.pos.y,0,m-s.size.h);this._state===2&&this._ball.update(t),this._ball.shape.yMin<0&&(this._ball.pos.y=0,this._ball.dir.y=-this._ball.dir.y,g.playRandomImpactSound(this._ball.speed)),this._ball.shape.yMax>m&&(this._ball.pos.y=m-this._ball.size.h,this._ball.dir.y=-this._ball.dir.y,g.playRandomImpactSound(this._ball.speed));for(let s of e)if(this._ball.collidesWith(s)){const i=(this._ball.shape.yMid-s.shape.yMid)/(s.size.h/2),n=Math.PI/3;let o=0;s===this._player1?o=i*n:o=Math.PI-i*n,this._ball.dir=c.fromAngle(o),this._ball.increaseSpeed(),g.playRandomImpactSound(this._ball.speed)}this._state===2&&(this._ball.shape.xMax<0&&this.endRound(this._player2),this._ball.shape.xMin>y&&this.endRound(this._player1))}draw(t){if(t.drawImage(this._background,0,0),this._state!==0){const e=`${this._player1.score} vs ${this._player2.score}`;t.drawText(e,y/2,48,{font:"48px Jumpman",color:"#ffffff",align:"center"})}this._player1.draw(t),this._player2.draw(t),this._ball?.draw(t)}start(){this._state=0,this._player1=N(_.One),this._player2=N(_.Two),this._ball=F(),this.startRound()}startRound(t=1){v.after(t,()=>{g.playSound("ready"),this._state=1,this._ball=F(),v.every(.1,At,()=>{this._ball.isVisible=this._ball.isVisible===!1},()=>{this._ball.isVisible=!0,this._state=2,g.playSound("go")})})}endRound(t){t.score+=1,this._player1.score===H||this._player2.score===H?(this._state=4,v.after(.2,()=>{this._state=0,Et(this._player1.score>this._player2.score?_.One:_.Two)})):(this._state=3,this.startRound())}}async function Pt(){await u.resolve(f).preload()}function Wt(){const a=u.resolve(M);a.switch(new Nt),a.push(new X)}class Ft extends T{_isLoading=!1;_time=0;_suffix="";update(t){this._time+=t*3,this._suffix="";const e=Math.floor(this._time%4);for(let s=0;s<e;s++)this._suffix+=".";this._isLoading||(this._isLoading=!0,Pt().then(s=>Wt()))}draw(t){let e=`Loading${this._suffix}`;t.drawText(e,y/2,m/2,{align:"center",font:"32px fantasy"})}}class Ot{_sceneManager;_inputListener;constructor(t){this._inputListener=new B(t),u.register(B,this._inputListener),this._sceneManager=new M(t.width,t.height),u.register(M,this._sceneManager);const e=new f;u.register(f,e),l.init(t)}async init(){this._sceneManager.switch(new Ft)}update(t){this._sceneManager.update(t),this._inputListener.wasKeyReleased("F1")&&(L.showFps=!L.showFps,L.showDraws=!L.showDraws),this._inputListener.update(),v.update(t),l.update()}draw(t){this._sceneManager.draw(t)}}class Bt{_ctx;_draws=0;get drawCount(){return this._draws}constructor(t){this._ctx=t}startFrame(){this._draws=0,this._ctx.clearRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}drawRect(t,e,s,i,n){this._draws+=1,this._ctx.fillStyle=n,this._ctx.fillRect(t,e,s,i)}drawImage(t,e,s){this._draws+=1,this._ctx.drawImage(t,e,s)}drawText(t,e,s,i={}){this._draws+=1,i.font&&(this._ctx.font=i.font);const n=this._ctx.measureText(t),o=n.actualBoundingBoxAscent+n.actualBoundingBoxDescent;switch(i.align){case"center":e-=n.width/2;break;case"right":e-=n.width;break}this._draws+=1,this._ctx.fillStyle=i.color??"#ffffff",this._ctx.fillText(t,e,s+o/2)}}const D=document.getElementById("game");D.width=y;D.height=m;document.body.appendChild(D);const Y=new Ot(D);await Y.init();const A=D.getContext("2d"),O=new Bt(A);function Z(a){O.startFrame(),$.update(a,t=>Y.update(t)),Y.draw(O);{A.fillStyle="white",A.font="16px monospace";let t=20;L.showFps&&(A.fillText(`FPS: ${$.fps}`,10,t),t+=20),L.showDraws&&A.fillText(`Draws: ${O.drawCount}`,10,t)}requestAnimationFrame(Z)}requestAnimationFrame(Z);
