(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(a){if(a.ep)return;a.ep=!0;const n=e(a);fetch(a.href,n)}})();class C{static showFps=!1;static showDraws=!1}class D{static generate(t,e,i){const a=document.createElement("canvas");a.width=t,a.height=e;const n=a.getContext("2d");return i(n),a}static stretch(t,e,i,a=10){const n=t.width,r=t.height,o=document.createElement("canvas");o.width=e,o.height=i;const g=o.getContext("2d"),b=[0,a,e-a,e],k=[0,a,i-a,i],z=[0,a,n-a,n],l=[0,a,r-a,r];for(let h=0;h<3;h++)for(let S=0;S<3;S++){const tt=z[S],et=l[h],st=z[S+1]-z[S],it=l[h+1]-l[h],at=b[S],nt=k[h],rt=b[S+1]-b[S],ot=k[h+1]-k[h];g.drawImage(t,tt,et,st,it,at,nt,rt,ot)}return o}}class ht{constructor(t){this.compare=t}data=[];push(t){this.data.push(t),this.bubbleUp()}pop(){if(this.size()===0)return;const t=this.data[0],e=this.data.pop();return this.size()>0&&(this.data[0]=e,this.bubbleDown()),t}peek(){return this.data[0]}size(){return this.data.length}bubbleUp(){let t=this.data.length-1;for(;t>0;){const e=t-1>>1;if(this.compare(this.data[t],this.data[e])>=0)break;[this.data[t],this.data[e]]=[this.data[e],this.data[t]],t=e}}bubbleDown(){let t=0;const e=this.data.length;for(;;){const i=2*t+1,a=2*t+2;let n=t;if(i<e&&this.compare(this.data[i],this.data[n])<0&&(n=i),a<e&&this.compare(this.data[a],this.data[n])<0&&(n=a),n===t)break;[this.data[t],this.data[n]]=[this.data[n],this.data[t]],t=n}}}class L{_time=0;_heap;static _default=new L;constructor(){this._heap=new ht((t,e)=>t.scheduledAt-e.scheduledAt)}update(t){for(this._time+=t;;){const e=this._heap.peek();if(!e||e.scheduledAt>this._time)break;this._heap.pop()?.action()}}static update(t){this._default.update(t)}after(t,e){this._heap.push({scheduledAt:this._time+t,action:e})}static after(t,e){this._default.after(t,e)}every(t,e,i,a){const n=this._time+t,r=this._time+e;for(let o=n;o<=r;o+=t)this._heap.push({scheduledAt:o,action:i});a&&this._heap.push({scheduledAt:r,action:a})}static every(t,e,i,a){this._default.every(t,e,i,a)}removeAllTimers(){for(;this._heap.size()>0;)this._heap.pop()}static removeAllTimers(){this._default.removeAllTimers()}}class A{static _alpha=0;static _accumulator=0;static _fps=0;static _lastTime=performance.now();static timeStep=1/60;static get lastTime(){return this._lastTime}static get fps(){return Math.floor(this._fps)}static get alpha(){return this._alpha}static update(t,e){const i=(t-this._lastTime)/1e3;for(this._fps=1/i,this._lastTime=t,this._accumulator+=i;this._accumulator>=this.timeStep;)e(this.timeStep),this._accumulator-=this.timeStep;this._alpha=this._accumulator/this.timeStep}}class ct{_ctx;_draws=0;get drawCount(){return this._draws}constructor(t){this._ctx=t}startFrame(t="#00000000"){this._draws=0,this._ctx.fillStyle=t,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this._ctx.fillStyle="#ffffff"}drawRect(t,e,i,a,n){this._draws+=1,this._ctx.fillStyle=n,this._ctx.fillRect(t,e,i,a)}drawImage(t,e,i){this._draws+=1,this._ctx.drawImage(t,e,i)}drawText(t,e,i,a={}){this._draws+=1,a.font&&(this._ctx.font=a.font);const n=this._ctx.measureText(t),r=n.actualBoundingBoxAscent+n.actualBoundingBoxDescent;switch(a.align){case"center":e-=n.width/2;break;case"right":e-=n.width;break}this._draws+=1,this._ctx.fillStyle=a.color??"#ffffff",this._ctx.fillText(t,e,i+r/2)}drawSprite(t,e,i,a,n=0,r=0){this._draws+=1,this._ctx.drawImage(t,e.x,e.y,e.w,e.h,i+n,a+r,e.w,e.h)}applyCamera(t){t?(this._ctx.save(),this._ctx.scale(t.scale,t.scale),this._ctx.translate(-t.pos.x,-t.pos.y)):this._ctx.restore()}}class N{async init(){}deinit(){}}class v{constructor(t,e){this.width=t,this.height=e}_scenes=[{async init(){},deinit(){},update(){},draw(){}}];get current(){return this._scenes[this._scenes.length-1]}async switch(t){await t.init(),this._scenes=[t]}async push(t){await t.init(),this._scenes.push(t)}pop(){return this._scenes.length>1?(this._scenes.pop(),!0):!1}update(t){this._scenes[this._scenes.length-1].update(t)}draw(t){for(let e of this._scenes)e.draw(t)}}const d={rect(s,t,e,i){return{kind:"rect",x:s,y:t,w:e,h:i}},circle(s,t,e){return{kind:"circle",x:s,y:t,r:e}},min(s){return{x:s.x,y:s.y}},mid(s){switch(s.kind){case"circle":return{x:s.x+s.r,y:s.y+s.r};case"rect":return{x:s.x+s.w/2,y:s.y+s.h/2}}},max(s){switch(s.kind){case"circle":return{x:s.x+s.r*2,y:s.y+s.r*2};case"rect":return{x:s.x+s.w,y:s.y+s.h}}},containsPoint(s,t){switch(s.kind){case"circle":return dt(s,t);case"rect":return lt(s,t)}},intersects(s,t){switch(s.kind){case"rect":switch(t.kind){case"rect":return pt(s,t);case"circle":return q(t,s)}case"circle":switch(t.kind){case"rect":return q(s,t);case"circle":return ut(s,t)}}}};function lt(s,t){const e=s.x+s.w,i=s.y+s.h;return t.x>=s.x&&t.x<=e&&t.y>=s.y&&t.y<=i}function dt(s,t){const e=s.x+s.r,i=s.y+s.r,a=e-t.x,n=i-t.y;return a*a+n*n<=Math.pow(s.r,2)}function ut(s,t){const e=s.x-t.x,i=s.y-t.y,a=e*e+i*i,n=s.r+t.r;return a<n*n}function q(s,t){const e=s.x+s.r,i=s.y+s.r,a=Math.max(t.x,Math.min(e,t.x+t.w)),n=Math.max(t.y,Math.min(i,t.y+t.h)),r=e-a,o=i-n;return r*r+o*o<s.r*s.r}function pt(s,t){return s.x<t.x+t.w&&s.x+s.w>t.x&&s.y<t.y+t.h&&s.y+s.h>t.y}function mt(s){return s.replace(/^(?:\r\n|\r|\n)+|(?:\r\n|\r|\n)+$/g,"")}function K(s){const t={name:s.tagName,attributes:{},children:[]};for(const e of s.attributes)t.attributes[e.name]=e.value;for(const e of s.childNodes)if(e.nodeType===Node.ELEMENT_NODE)t.children.push(K(e));else if(e.nodeType===Node.TEXT_NODE&&e.textContent){const i=mt(e.textContent);i&&(t.text=i)}return t}const U={parse(s){let t;try{t=new DOMParser().parseFromString(s,"application/xml")}catch(a){throw new Error("XML Parse Error: "+(a instanceof Error?a.message:String(a)))}const e=t.querySelector?.("parsererror");if(e)throw new Error("XML Parse Error: "+e.textContent);const i=t.documentElement;return K(i)},findNodes(s,t,e){const i=[];function a(n){n.name===t&&(!e||U.matchAttributes(n,e))&&i.push(n);for(const r of n.children)a(r)}return a(s),i},matchAttributes(s,t){for(const[e,i]of Object.entries(t))if(s.attributes[e]!==i)return!1;return!0}},f={new(s,t){return{x:s,y:t}},get zero(){return{x:0,y:0}},fromAngle(s){return{x:Math.cos(s),y:Math.sin(s)}},add(s,t){return{x:s.x+t.x,y:s.y+t.y}},sub(s,t){return{x:s.x-t.x,y:s.y-t.y}},mul(s,t){return{x:s.x*t,y:s.y*t}},lerp(s,t,e){return{x:s.x+(t.x-s.x)*e,y:s.y+(t.y-s.y)*e}},clone(s){return{x:s.x,y:s.y}},length(s){return Math.hypot(s.x,s.y)},normalize(s){const t=f.length(s);return t===0?{x:0,y:0}:f.mul(s,1/t)},isEqual(s,t){return s.x===t.x&&s.y===t.y}};class P{children;minSize;stretch;spacing;expSize=null;frame=null;constructor(t,e={w:0,h:0},i="all",a){this.children=t,this.minSize=e,this.stretch=i,this.spacing=a}reshape(t,e,i,a){this.expand(),this.layout(d.rect(t,e,i,a))}*widgets(){for(const t of this.children)yield*t.widgets()}expand(){for(const t of this.children)t.expand();this.expandChildren()}layout(t){this.layoutChildren(t);for(const e of this.children)e.frame&&e.layout(e.frame)}static spread(t,e){const i=e.map(([l])=>l),a=e.map(([,l])=>l),n=i.reduce((l,h)=>l+h,0),r=Math.max(0,t-n),o=a.reduce((l,h)=>l+h,0),g=o>0?Math.floor(r/o):0,b=a.map(l=>l*g),k=b.reduce((l,h)=>l+h,0),z=r-k;if(z!==0){const l=a.map((h,S)=>[h,S]).filter(([h])=>h>0).map(([,h])=>h).pop();l!==void 0&&(b[l]+=z)}return i.map((l,h)=>l+b[h])}}class _t extends P{widget;constructor(t,e={w:0,h:0},i="all"){super([],e,i,0),this.widget=t}*widgets(){yield this.widget}expandChildren(){this.expSize=this.minSize}layoutChildren(t){this.widget.setFrame(t)}}class ft extends P{margin;constructor(t,e={w:0,h:0},i="all",a={l:0,t:0,r:0,b:0}){super(t,e,i,0),this.margin=a}expandChildren(){let t=this.margin.l+this.margin.r,e=this.margin.t+this.margin.b;for(const i of this.children)i.expSize&&(t=Math.max(t,i.expSize.w),e=Math.max(e,i.expSize.h));this.expSize={w:t,h:e}}layoutChildren(t){const{l:e,t:i,r:a,b:n}=this.margin,r=t.x+e,o=t.y+i,g=t.w-e-a,b=t.h-i-n;this.frame=d.rect(r,o,g,b);for(const k of this.children)k.frame=d.rect(r,o,g,b)}}class gt extends P{expandChildren(){let t=0,e=0;for(const i of this.children)i.expSize&&(t=Math.max(t,i.expSize.w),e+=i.expSize.h);e+=Math.max(0,this.children.length-1)*this.spacing,this.expSize={w:t,h:e}}layoutChildren(t){const e=Math.max(0,this.children.length-1)*this.spacing,i=P.spread(t.h-e,this.children.map(n=>[n.expSize?.h??0,n.stretch==="vertical"||n.stretch==="all"?1:0]));let a=t.y;for(let n=0;n<this.children.length;++n){const r=this.children[n],o=i[n],g=r.stretch==="horizontal"||r.stretch==="all"?t.w:r.expSize?.w??0;r.frame=d.rect(t.x,a,g,o),a+=o+this.spacing}}}class wt extends P{expandChildren(){let t=0,e=0;for(const i of this.children)i.expSize&&(t+=i.expSize.w,e=Math.max(e,i.expSize.h));t+=Math.max(0,this.children.length-1)*this.spacing,this.expSize={w:t,h:e}}layoutChildren(t){const e=Math.max(0,this.children.length-1)*this.spacing,i=P.spread(t.w-e,this.children.map(n=>[n.expSize?.w??0,n.stretch==="horizontal"||n.stretch==="all"?1:0]));let a=t.x;for(let n=0;n<this.children.length;++n){const r=this.children[n],o=i[n],g=r.stretch==="vertical"||r.stretch==="all"?t.h:r.expSize?.h??0;r.frame=d.rect(a,t.y,o,g),a+=o+this.spacing}}}const p={border(s,t={}){return new ft(Array.isArray(s)?s:[s],t.minSize??{w:0,h:0},t.stretch??"all",t.margin??{t:0,b:0,l:0,r:0})},hstack(s,t={}){return new wt(Array.isArray(s)?s:[s],{w:0,h:0},t.stretch??"horizontal",t.spacing??0)},vstack(s,t={}){return new gt(Array.isArray(s)?s:[s],{w:0,h:0},t.stretch??"vertical",t.spacing??0)},elem(s,t={}){return new _t(s,t.minSize??{w:0,h:0},t.stretch??"none")},size(s,t){return{w:s,h:t}},margin(s,t,e,i){return{l:s,t,r:e,b:i}}},yt={new(s){const t=[],e=s.attributes.imagePath,i=U.findNodes(s,"SubTexture");for(let a of i)t.push({x:Number(a.attributes.x),y:Number(a.attributes.y),w:Number(a.attributes.width),h:Number(a.attributes.height)});return{image:xt(e),sprites:t}}};function xt(s){const t=s.split("/").pop()?.split("\\").pop()?.split(".")||[];return t.length<=1?t[0]||"":(t.pop(),t.join("."))}function I(s){const t=s.split("/").pop()?.split("\\").pop()?.split(".")||[];return t.length<=1?t[0]||"":(t.pop(),t.join("."))}const bt=[".png",".jpg"],St=[".wav",".mp3",".ogg"],Mt=[".ttf"];class w{_imageRegistry=new Map;_audioRegistry=new Map;_xmlRegistry=new Map;_spriteSheetRegistry=new Map;getImage(t){return this._imageRegistry.get(t)}getAudio(t){return this._audioRegistry.get(t)}getXml(t){return this._xmlRegistry.get(t)}getSpriteSheet(t){return this._spriteSheetRegistry.get(t)}async preload(){try{const t=await fetch("assets/manifest.json");if(!t.ok)throw new Error(`Failed to load manifest: ${t.statusText}`);const e=await t.json();console.log("Manifest loaded:",e);for(const i of e.assets){const a=`assets/${i}`;if(console.log(`Loading asset: ${a}`),bt.some(n=>a.endsWith(n))){const n=new Image;n.src=a,await n.decode(),this._imageRegistry.set(I(i),n);continue}if(St.some(n=>a.endsWith(n))){const n=new Audio(a);n.load(),this._audioRegistry.set(I(i),n);continue}if(Mt.some(n=>a.endsWith(n))){const n=I(i),r=new FontFace(n,`url(${a})`);await r.load(),document.fonts.add(r);continue}if(a.endsWith(".xml")){const r=await(await fetch(a)).text(),o=U.parse(r);this._xmlRegistry.set(I(i),o);continue}}}catch(t){console.error("Error loading manifest:",t)}}loadSpriteSheet(t){const e=this.getXml(t),i=yt.new(e);this._spriteSheetRegistry.set(i.image,i.sprites)}}var B=(s=>(s[s.DPadU=1]="DPadU",s[s.DPadD=2]="DPadD",s[s.DPadL=4]="DPadL",s[s.DPadR=8]="DPadR",s[s.ButtonA=16]="ButtonA",s[s.ButtonB=32]="ButtonB",s[s.ButtonX=64]="ButtonX",s[s.ButtonY=128]="ButtonY",s[s.ButtonL=256]="ButtonL",s[s.ButtonR=512]="ButtonR",s[s.Start=1024]="Start",s[s.Select=2048]="Select",s))(B||{});class ${_keyboardInputMap;_gamepadInputMap;_heldKeys=new Set;_mousePos=f.new(-1,-1);_isMouseDown=!1;_isMouseClicked=!1;_stateBuffer=[0,0];_stateIdx=0;constructor(t){this._keyboardInputMap=new Map([["w",1],["s",2],["a",4],["d",8],["space",16],["enter",1024],["f1",256],["esc",2048]]),this._gamepadInputMap=new Map([[12,1],[13,2],[14,4],[15,8],[0,16],[1,32],[2,64],[3,128],[4,256],[5,512],[8,1024],[9,2048]]),window.addEventListener("keydown",e=>{e.preventDefault(),this._heldKeys.add(e.key.toLowerCase())}),window.addEventListener("keyup",e=>{e.preventDefault(),this._heldKeys.delete(e.key.toLowerCase())}),window.addEventListener("mousedown",e=>{this._isMouseDown=!0}),window.addEventListener("mouseup",e=>{this._isMouseDown=!1,this._isMouseClicked=!0}),window.addEventListener("mousemove",e=>{const i=t.getBoundingClientRect();this._mousePos.x=e.clientX-i.left,this._mousePos.y=e.clientY-i.top}),window.addEventListener("gamepadconnected",e=>{console.log("Gamepad connected:",e.gamepad)}),window.addEventListener("gamepaddisconnected",e=>{console.log("Gamepad disconnected:",e.gamepad)})}update(){this._stateIdx=1-this._stateIdx;var t=0;this._isMouseClicked=!1;const i=navigator.getGamepads()[0];if(i)for(let[a,n]of this._gamepadInputMap)i.buttons[a].pressed&&(t|=n);for(const a of this._heldKeys){const n=this._keyboardInputMap.get(a);n&&(t|=n)}this._stateBuffer[this._stateIdx]=t}isInputDown(t){return(this._stateBuffer[this._stateIdx]&t)!==0}isInputReleased(t){const e=this._stateBuffer[this._stateIdx],i=this._stateBuffer[1-this._stateIdx];return(e&t)!==0&&(i&t)===0}getMousePosition(){return{x:this._mousePos.x,y:this._mousePos.y}}get isMouseDown(){return this._isMouseDown}get isMouseClicked(){return this._isMouseClicked}}class u{static services=new Map;static register(t,e){this.services.set(t,e)}static resolve(t){if(!this.services.has(t))throw new Error(`No service registered of type: ${t.name}.`);return this.services.get(t)}}function vt(s){return u.resolve(w).getImage(s)}class G{_state=0;_frame=d.rect(0,0,0,0);get state(){return this._state}setState(t){this._state=t}get frame(){return this._frame}setFrame(t){this._frame=d.rect(t.x,t.y,t.w,t.h)}update(t){}}class J extends G{_ox=0;_oy=0;_font;_text;_textColor;_fontSize;_backgroundName;_background;constructor(t,e){super(),this._text=t,this._textColor=e?.textColor??"#eeeeee";const i=e?.font??"Jumpman";this._fontSize=e?.size??24,this._font=`${this._fontSize}px ${i}`,this._backgroundName=e?.background}setFrame(t){if(super.setFrame(t),this._ox=t.x+Math.floor(t.w/2),this._oy=t.y+Math.floor(t.h/2),this._backgroundName){let e=vt(this._backgroundName);this._background=D.stretch(e,t.w,t.h)}}draw(t){this._background&&t.drawImage(this._background,this.frame.x,this.frame.y),t.drawText(this._text,this._ox,this._oy,{font:this._font,align:"center",color:this._textColor})}}class kt extends G{_background;_imageName;constructor(t){super(),this._imageName=t}draw(t){t.drawImage(this._background,this._frame.x,this._frame.y)}setFrame(t){super.setFrame(t);const i=u.resolve(w).getImage(this._imageName);this._background=D.stretch(i,t.w,t.h)}}class Lt extends J{_onClick;_stateBackgrounds=new Map;constructor(t,e){super(t,e),this._onClick=e?.onClick?e.onClick:()=>{}}setFrame(t){super.setFrame(t);const e=u.resolve(w),i=new Map([[0,"button_square_depth_flat"],[1,"button_square_depth_gloss"],[2,"button_square_gloss"],[3,"button_square_depth_flat"]]);for(let[a,n]of i){let r=e.getImage(n);r=D.stretch(r,t.w,t.h),this._stateBackgrounds.set(a,r)}this._background=this._stateBackgrounds.get(0)}setState(t){super.setState(t),this._background=this._stateBackgrounds.get(this.state)}update(t){const e=d.containsPoint(this._frame,c.mouse.pos),i=e&&c.mouse.buttonState==="down",a=this.state===2&&c.mouse.buttonState==="up";if(e?this.setState(1):this.setState(0),i&&!a){const n=c.mouse.buttonState==="down"?2:1;this.setState(n)}a&&(this._onClick(),this.setState(0))}}class zt extends G{draw(t){}}class c{static panel(t="button_square_border"){return p.elem(new kt(t),{minSize:{w:0,h:0},stretch:"all"})}static label(t,e){return p.elem(new J(t,e),{minSize:{w:0,h:e?.size??48},stretch:"horizontal"})}static button(t,e){return p.elem(new Lt(t,e),{minSize:{w:192,h:64},stretch:"horizontal"})}static flexSpace(t){return p.elem(new zt,{stretch:t})}static _mouse={pos:{x:0,y:0},buttonState:"none"};static get mouse(){return this._mouse}static init(t){window.addEventListener("mousedown",e=>{this._mouse.buttonState="down"}),window.addEventListener("mouseup",e=>{this._mouse.buttonState="up"}),window.addEventListener("mousemove",e=>{const i=t.getBoundingClientRect();this._mouse.pos.x=e.clientX-i.left,this._mouse.pos.y=e.clientY-i.top})}static update(){this._mouse.buttonState==="up"&&(this._mouse.buttonState="none")}}const x=1080,_=720,Ct=60;class Pt{_prevPos;get prevPos(){return this._prevPos}sprite;pos={x:0,y:0};size;isVisible=!0;constructor(t,e){this.sprite=t,this.pos=e??{x:0,y:0},this._prevPos=f.clone(this.pos),this.size={w:t.width,h:t.height}}update(t){this._prevPos=f.clone(this.pos)}draw(t){if(!this.isVisible)return;const e=f.lerp(this._prevPos,this.pos,A.alpha);t.drawImage(this.sprite,Math.floor(e.x),Math.floor(e.y))}}class Q extends Pt{dir=f.zero;speed=8;update(t){super.update(t);const e=f.mul(this.dir,this.speed*Ct*t);this.pos=f.add(this.pos,e),this.shape.x=this.pos.x,this.shape.y=this.pos.y}collidesWith(t){return d.intersects(this.shape,t.shape)}}class H extends Q{_shape;get shape(){return this._shape}player;score=0;constructor(t,e,i){super(t,e),this.player=i,this._shape=d.rect(this.pos.x,e.y,this.size.w,this.size.h)}}class Et extends Q{_shape;alpha=1;get shape(){return this._shape}constructor(t,e){super(t,e);const i=this.sprite.width/2;this._shape=d.circle(this.pos.x,e.y,i)}increaseSpeed(){this.speed=Math.min(this.speed+1,20)}draw(t){super.draw(t)}}var m=(s=>(s[s.One=0]="One",s[s.Two=1]="Two",s))(m||{});const M={None:f.zero,Up:{x:0,y:-1},Down:{x:0,y:1}};class y{static playSound(t){const i=u.resolve(w).getAudio(t);i.currentTime=0,i.play()}static playRandomImpactSound(t){u.resolve(w);const e=t<12?"heavy":t<16?"medium":"light";let i=[];switch(e){case"light":i=["impactWood_light_000","impactWood_light_001","impactWood_light_002","impactWood_light_003","impactWood_light_004"];break;case"medium":i=["impactWood_medium_000","impactWood_medium_001","impactWood_medium_002","impactWood_medium_003","impactWood_medium_004"];break;case"heavy":i=["impactWood_heavy_000","impactWood_heavy_001","impactWood_heavy_002","impactWood_heavy_003","impactWood_heavy_004"];break}const a=Math.floor(Math.random()*i.length);this.playSound(i[a])}}function Dt(){y.playSound("click5");const s=u.resolve(v);s.pop(),s.push(new Y)}class Nt extends N{_layout=p.border([c.panel(),p.border([p.vstack([c.label("Instructions",{size:40,textColor:"#ee2747"}),c.label("You control the left paddle.",{size:26,textColor:"#ee2747"}),c.label("Press <W> to move up, <S> to move down.",{size:26,textColor:"#ee2747"}),c.label("You score a point by moving the ball in opponent goal.",{size:26,textColor:"#ee2747"}),c.label("The first player that scores 5 points wins the game.",{size:26,textColor:"#ee2747"}),c.button("Menu",{size:32,onClick:()=>Dt()})],{spacing:20})],{margin:p.margin(16,16,16,16)})]);constructor(){super();const t=760,e=40+4*26+64+5*20+32,i=(x-t)/2,a=(_-e)/2;this._layout.reshape(i,a,t,e)}update(t){for(let e of this._layout.widgets())e.update(t)}draw(t){for(let e of this._layout.widgets())e.draw(t)}}function Tt(){y.playSound("click5");const s=u.resolve(v);s.pop(),s.current.start()}function It(){y.playSound("click5");const s=u.resolve(v);s.pop(),s.push(new Nt)}class Y extends N{_layout=p.border([c.panel(),p.border([p.vstack([c.label("Pong!",{size:40,textColor:"#ee2747"}),c.button("Play",{size:32,onClick:()=>Tt()}),c.button("Instructions",{size:32,onClick:()=>It()})],{spacing:20})],{margin:p.margin(16,16,16,16)})]);constructor(){super();const t=300,e=40+64*2+20*2+32,i=(x-t)/2,a=(_-e)/2;this._layout.reshape(i,a,t,e)}update(t){for(let e of this._layout.widgets())e.update(t)}draw(t){for(let e of this._layout.widgets())e.draw(t)}}function Rt(){y.playSound("click5");const s=u.resolve(v);s.pop(),s.push(new Y)}function Bt(s){return p.border([c.panel(),p.border([p.vstack([c.label("Game Over",{size:26,textColor:"#ee2747"}),c.label(s===m.One?"You Win!":"You Lose!",{size:40,textColor:"#ee2747"}),c.button("Menu",{size:32,onClick:()=>Rt()})],{spacing:20})],{margin:p.margin(16,16,16,16)})])}class Ot extends N{_layout=p.border([]);_winner;constructor(t){super(),this._winner=t,this._layout=Bt(t);const e=300,i=130+20*2+32,a=(x-e)/2,n=(_-i)/2;this._layout.reshape(a,n,e,i)}update(t){for(let e of this._layout.widgets())e.update(t)}draw(t){for(let e of this._layout.widgets())e.draw(t)}async init(){switch(this._winner){case m.One:y.playSound("you_win");break;case m.Two:y.playSound("you_lose");break}}}const V=10,O=5,Wt=1.6,j=5;function Ft(){const t=u.resolve(w).getImage("texture_08");return D.generate(x,_,e=>{for(let i=0;i<e.canvas.width;i+=t.width)for(let a=0;a<e.canvas.height;a+=t.height)e.drawImage(t,i,a)})}function R(s){const t=u.resolve(w);switch(s){case m.One:{const e=t.getImage("paddleBlu"),i=f.new(V,(_-e.height)/2);return new H(e,i,m.One)}case m.Two:{const e=t.getImage("paddleRed"),i=f.new(x-e.width-V,(_-e.height)/2);return new H(e,i,m.Two)}}}function At(s,t,e){return Math.max(Math.min(s,e),t)}function W(){const t=u.resolve(w).getImage("ballGrey"),e=f.new((x-t.width)/2,(_-t.height)/2),i=new Et(t,e);let a=(Math.random()-.5)*Math.PI/1.5;return a+=Math.random()>.5?0:Math.PI,i.dir=f.fromAngle(a),i}function $t(s){u.resolve(v).push(new Ot(s))}function Xt(s,t,e){const i=u.resolve($);switch(s.dir=M.None,s.player){case m.One:i.isInputDown(B.DPadU)&&(s.dir=M.Up),i.isInputDown(B.DPadD)&&(s.dir=M.Down);break;case m.Two:if(e===3){s.dir=M.None;let{y:a}=d.mid(s.shape);a<_/2-O&&(s.dir=M.Down),a>_/2+O&&(s.dir=M.Up)}if(e===2&&t.dir.x>0){let a=d.mid(s.shape),n=d.mid(t.shape);const r=a.y-n.y;Math.abs(r)>O&&(s.dir=r>0?M.Up:M.Down)}break}}class Ut extends N{_state=0;_background;_player1=R(m.One);_player2=R(m.Two);_ball=W();constructor(){super(),this._background=Ft()}async init(){const e=u.resolve(w).getImage("texture_08");this._background=D.generate(x,_,i=>{for(let a=0;a<i.canvas.width;a+=e.width)for(let n=0;n<i.canvas.height;n+=e.height)i.drawImage(e,a,n)})}deinit(){L.removeAllTimers()}update(t){if(this._state===0)return;let e=[this._player1,this._player2];for(let a of e)Xt(a,this._ball,this._state),a.update(t),a.pos.y=At(a.pos.y,0,_-a.size.h);(this._state===2||this._state===3)&&this._ball.update(t);const i=d.mid(this._ball.shape);d.min(this._ball.shape).y<0&&(this._ball.pos.y=0,this._ball.dir.y=-this._ball.dir.y,y.playRandomImpactSound(this._ball.speed)),d.max(this._ball.shape).y>_&&(this._ball.pos.y=_-this._ball.size.h,this._ball.dir.y=-this._ball.dir.y,y.playRandomImpactSound(this._ball.speed));for(let a of e){const n=d.mid(a.shape);if(this._ball.collidesWith(a)){const r=(i.y-n.y)/(a.size.h/2),o=Math.PI/3;let g=0;a===this._player1?g=r*o:g=Math.PI-r*o,this._ball.dir=f.fromAngle(g),this._ball.increaseSpeed(),y.playRandomImpactSound(this._ball.speed)}}this._state===2&&(d.max(this._ball.shape).x<0&&this.endRound(this._player2),d.min(this._ball.shape).x>x&&this.endRound(this._player1))}draw(t){if(t.drawImage(this._background,0,0),this._state!==0){const e=`${this._player1.score} vs ${this._player2.score}`;t.drawText(e,x/2,48,{font:"48px Jumpman",color:"#ffffff",align:"center"})}this._player1.draw(t),this._player2.draw(t),this._ball?.draw(t)}start(){this._state=0,this._player1=R(m.One),this._player2=R(m.Two),this._ball=W(),this.startRound()}startRound(t=1){L.after(t,()=>{y.playSound("ready"),this._state=1,this._ball=W(),L.every(.1,Wt,()=>{this._ball.isVisible=this._ball.isVisible===!1},()=>{this._ball.isVisible=!0,this._state=2,y.playSound("go")})})}endRound(t){t.score+=1,this._player1.score===j||this._player2.score===j?(this._state=4,L.after(.2,()=>{this._state=0,$t(this._player1.score>this._player2.score?m.One:m.Two)})):(this._state=3,this.startRound())}}async function Gt(){await u.resolve(w).preload()}function Yt(){const s=u.resolve(v);s.switch(new Ut),s.push(new Y)}class qt extends N{_isLoading=!1;_time=0;_suffix="";update(t){this._time+=t*3,this._suffix="";const e=Math.floor(this._time%4);for(let i=0;i<e;i++)this._suffix+=".";this._isLoading||(this._isLoading=!0,Gt().then(i=>Yt()))}draw(t){let e=`Loading${this._suffix}`;t.drawText(e,x/2,_/2,{align:"center",font:"32px fantasy"})}}class Ht{_sceneManager;_inputListener;_assetLoader;constructor(t){this._inputListener=new $(t),u.register($,this._inputListener),this._sceneManager=new v(t.width,t.height),u.register(v,this._sceneManager),this._assetLoader=new w,u.register(w,this._assetLoader),c.init(t)}async init(){this._sceneManager.switch(new qt)}update(t){this._sceneManager.update(t),this._inputListener.isInputReleased(B.ButtonL)&&(C.showFps=!C.showFps,C.showDraws=!C.showDraws),this._inputListener.update(),L.update(t),c.update()}draw(t){this._sceneManager.draw(t)}}const T=document.getElementById("game");T.width=x;T.height=_;document.body.appendChild(T);const X=new Ht(T);await X.init();const E=T.getContext("2d"),F=new ct(E);function Z(s){F.startFrame(),A.update(s,t=>X.update(t)),X.draw(F);{E.fillStyle="white",E.font="16px monospace";let t=20;C.showFps&&(E.fillText(`FPS: ${A.fps}`,10,t),t+=20),C.showDraws&&E.fillText(`Draws: ${F.drawCount}`,10,t)}requestAnimationFrame(Z)}requestAnimationFrame(Z);
